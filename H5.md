#h5

## a) Watch it! 

> Asenna Saltilla SSHD asetuksineen. Lisää ssh-demonille ylimääräinen portti. 
> Osoita testein, että uusi portti toimii. 
> Vaihda porttia masterilla olevasta asetustiedoston mallista (/srv/salt/sshd/sshd_config tms), aja tila orjille, ja osoita testein, että palvelin käynnistyy, jos ja vain jos asetustiedoston malli masterilla on muuttunut. 
> Vinkki: Karvinen 2018: Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port

Tein sshd nimisen kansion srv/salt hakemistoon. Seuraavaksi tein seuraavanlaiset tilat sisältävän init.sls tiedoston.
 
Kopioin sshd_config -tiedoston sshd-kansioon
*sudo cp -v /etc/ssh/sshd_config /srv/salt/sshd/*, 

jossa muutin käytettäväksi portiksi portin 2222 

---
Lähde: Karvinen T. 2018 Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port

Luettavissa: https://terokarvinen.com/2018/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=salt%20service

Luettu: 30.11.2021

---

Asetin aiemmin tekemät salt tilat 

*sudo salt-call --local state.apply sshd*

ja vastaukseksi sain yhden onnistuneen tilan ja kaksi epäonnistunutta.


Kävin katsomassa onko muilla ollut samanlaisia ongelmia ja huomasin virheen tilassani:

/etc/ssh/sshd_config:
  file.managed:
    - source: salt://sshd_config
--->

/etc/ssh/sshd_config:
  file.managed:
    - source: salt://sshd/sshd_config

Lähde: Lintula T. 2021

Luettavissa: https://tuomaslintula.wordpress.com/2021/11/29/tehtava-h5-2/

Luettu: 30.11.2021

Virheen korjattua komento meni läpi.


## b) Securerer shell. 
>Tee Saltin kautta jokin muu sshd:n asetus ja osoita, että se toimii. Siivoa sshd_configista turhat kommenttirivit. Laita tiedostoon kommentti, jossa varoitetaan, että tiedosto ylikirjoittuu automaattisesti. Liitä siivottu sshd_config vastaukseesi.

## c) Maailman suosituin. 
>Tee Salt-tila (eli formula, siis omaa infraa koodina), joka asentaa Apache-weppipalvelimen. Korvaa testisivu /var/www/html/index.html sivulla, jossa lukee vain "Hello".

## d) Minä ja kissani. 
>Lisää Apache-reseptiisi (siihen Saltilla kirjoittamaasi) tuki käyttäjien kotisivuille. Voit laittaa kotisivut päälle 'a2enmod userdir', ottaa /etc/-tiedostoista aikajanan ja tehdä tarvittavat symlinkit file.symlink.

## e) Valmiiseen pöytään.
> Tee käyttäjille valmiit esimerkkikotisivut siten, että esimerkkikotisivu syntyy käyttäjää luodessa. Katso, että sivuille tulee oikea omistaja. Vinkki: /etc/skel/ kopioidaan luoduille käyttäjille. Kotisivuja etsitään osoitteesta /home/tero/public_html/index.html.

## f) Mootorix. 
>Tee Salt-tila, joka asentaa Nginx-weppipalvelimen ja tekee sille jonkin asetuksen. Vinkki: ensin käsin, vasta sitten automaattisesti. Tässä tehtävässä osa haastetta on selvittää, miten nginx otetaan käyttöön.
